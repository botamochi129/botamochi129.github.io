<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>勝炭鉄道 最新情報一覧</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <!-- 共通ヘッダーを挿入 -->
    <div id="header-container"></div>

<main>
    <section id="updates">
        <h2>最新情報一覧</h2>

        <!-- カテゴリフィルタ -->
        <div class="filter">
            <button data-type="all">すべて</button>
            <button data-type="ニュース">ニュース</button>
            <button data-type="イベント">イベント</button>
        </div>

        <div class="info-cards" id="updates-container">
            <!-- JSONから挿入 -->
        </div>

        <!-- ページネーション -->
        <div class="pagination" id="pagination"></div>
    </section>
</main>

    <!-- 共通フッターを挿入 -->
    <div id="footer-container"></div>

<script>
    // ヘッダー読み込み
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
            });

        // フッター読み込み
        fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
            });
    
    const updatesPerPage = 5;
    let allUpdates = [];
    let currentPage = 1;
    let currentFilter = 'all';

    async function loadAllUpdates() {
        try {
            const [newsRes, eventsRes] = await Promise.all([
                fetch('data/news.json'),
                fetch('data/events.json')
            ]);
            const news = await newsRes.json();
            const events = await eventsRes.json();

            allUpdates = [...news.map(item => ({...item, type: 'ニュース'})),
                          ...events.map(item => ({...item, type: 'イベント'}))];

            allUpdates.sort((a, b) => new Date(b.date) - new Date(a.date));

            renderUpdates();
            renderPagination();
        } catch (error) {
            console.error("最新情報一覧の読み込みに失敗しました:", error);
        }
    }

    function renderUpdates() {
        const container = document.getElementById('updates-container');
        container.innerHTML = '';

        const filtered = currentFilter === 'all' ? allUpdates : allUpdates.filter(u => u.type === currentFilter);
        const start = (currentPage - 1) * updatesPerPage;
        const end = start + updatesPerPage;
        const pageUpdates = filtered.slice(start, end);

        pageUpdates.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card ' + (item.type === 'ニュース' ? 'news-card' : 'event-card');
            card.innerHTML = `
                <h3>${item.date} - ${item.title} <span class="type">[${item.type}]</span></h3>
                <p>${item.content}</p>
            `;
            container.appendChild(card);
        });
    }

    function renderPagination() {
        const container = document.getElementById('pagination');
        container.innerHTML = '';

        const filtered = currentFilter === 'all' ? allUpdates : allUpdates.filter(u => u.type === currentFilter);
        const totalPages = Math.ceil(filtered.length / updatesPerPage);

        for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement('button');
            btn.textContent = i;
            if (i === currentPage) btn.disabled = true;
            btn.addEventListener('click', () => {
                currentPage = i;
                renderUpdates();
                renderPagination();
            });
            container.appendChild(btn);
        }
    }

    // フィルタボタン
    document.querySelectorAll('.filter button').forEach(btn => {
        btn.addEventListener('click', () => {
            currentFilter = btn.getAttribute('data-type');
            currentPage = 1;
            renderUpdates();
            renderPagination();
        });
    });

    loadAllUpdates();
</script>
